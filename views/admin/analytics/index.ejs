<!DOCTYPE html>
<html>
<head>
  <title>Admin Analytics</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4">

  <h2>📊 Admin Analytics / Insights</h2>

  <!-- Most & Least Claimed -->
  <div class="row mt-4">
    <div class="col-md-6">
      <div class="card p-3 shadow">
        <h5>🔥 Most Claimed Drop</h5>
        <% if (mostClaimed) { %>
          <p><b><%= mostClaimed.title %></b> (<%= mostClaimed.claimedBy.length %> claims)</p>
        <% } else { %>
          <p>No drops available</p>
        <% } %>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card p-3 shadow">
        <h5>❄️ Least Claimed Drop</h5>
        <% if (leastClaimed) { %>
          <p><b><%= leastClaimed.title %></b> (<%= leastClaimed.claimedBy.length %> claims)</p>
        <% } else { %>
          <p>No drops available</p>
        <% } %>
      </div>
    </div>
  </div>

  <!-- Revenue -->
  <div class="mt-4 card p-3 shadow">
    <h5>💰 Total Revenue Generated</h5>
    <h3>₹ <%= totalRevenue.toFixed(2) %></h3>
  </div>

  <!-- Charts -->
  <div class="mt-4 row">
    <!-- Bar Chart -->
    <div class="col-md-6">
      <div class="card p-3 shadow">
        <h5>📊 Claims per Drop (Bar Chart)</h5>
        <canvas id="barChart" height="150"></canvas>
      </div>
    </div>

    <!-- Line Chart -->
    <div class="col-md-6">
      <div class="card p-3 shadow">
        <h5>📈 Claims per Drop (Line Chart)</h5>
        <canvas id="lineChart" height="150"></canvas>
      </div>
    </div>
  </div>

  <script>
    const chartData = <%- chartData %>;

    // Bar Chart
    const barCtx = document.getElementById("barChart").getContext("2d");
    new Chart(barCtx, {
      type: "bar",
      data: {
        labels: chartData.map(d => d.title),
        datasets: [{
          label: "Claims",
          data: chartData.map(d => d.claims),
          borderWidth: 1,
          backgroundColor: "rgba(54, 162, 235, 0.6)",
          borderColor: "rgba(54, 162, 235, 1)"
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
      }
    });

    // Line Chart
    const lineCtx = document.getElementById("lineChart").getContext("2d");
    new Chart(lineCtx, {
      type: "line",
      data: {
        labels: chartData.map(d => d.title),
        datasets: [{
          label: "Claims Over Drops",
          data: chartData.map(d => d.claims),
          fill: true,
          tension: 0.3,
          borderColor: "rgba(75, 192, 192, 1)",
          backgroundColor: "rgba(75, 192, 192, 0.2)",
          pointBackgroundColor: "rgba(75, 192, 192, 1)"
        }]
      },
      options: {
        responsive: true,
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>

</body>
</html>
